import{d as e,r as t,v as a,S as n,o as r,c as u,w as o,e as i,L as m,i as l}from"./index-Fj9ozFXB.js";import{w as s}from"./wui-picker-view.BVMpPHUz.js";import{f as c,z as p,l as d,i as g,m as y,S as f,a3 as h,V as v,r as b,t as D,E as x,b as M}from"./page-wraper.D4oaE4iN.js";function N(e,t){const a=[],n=new Date(e);if("time"===t){const t=String(e).split(":");a.push(parseInt(t[0]),parseInt(t[1]))}else a.push(n.getFullYear(),n.getMonth()+1),"date"===t?a.push(n.getDate()):"datetime"===t&&a.push(n.getDate(),n.getHours(),n.getMinutes());return a}const w=M(e({name:"wui-datetime-picker-view",virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared",props:{...c,modelValue:p([String,Number,Date]),loading:d(!1),loadingColor:g("#4D80F0"),columnsHeight:y(217),valueKey:g("value"),labelKey:g("label"),type:g("datetime"),filter:Function,formatter:Function,columnFormatter:Function,minDate:y(new Date((new Date).getFullYear()-10,0,1).getTime()),maxDate:y(new Date((new Date).getFullYear()+10,11,31).getTime()),minHour:y(0),maxHour:y(23),minMinute:y(0),maxMinute:y(59),immediateChange:d(!1),startSymbol:d(!1)},emits:["change","pickstart","pickend","update:modelValue"],setup(e,{expose:c,emit:p}){const d=(e,t)=>32-new Date(e,t-1,32).getDate(),g=e,y=p,M=t(),w=t(null),H=t([]),F=t([]),V=t(!1),{proxy:$}=m();c({updateColumns:I,setColumns:function(e){H.value=e},getSelects:function(){var e;const t=null==(e=M.value)?void 0:e.getSelects();return null==t?void 0:b(t)?t:[t]},correctValue:Y,getPickerValue:N,getOriginColumns:S,...g});const k=f((()=>{if(!V.value)return;const e=Y(g.modelValue);e===w.value?H.value=I():P(e)}),50);function C({value:e}){F.value=e;const t=function(){var e;const{type:t}=g;let a="";const n=(null==(e=M.value)?void 0:e.getValues())||[],r=b(n)?n:[n];if("time"===t)return a=`${h(r[0])}:${h(r[1])}`,a;const u=r[0]&&parseInt(r[0]),o="year"===t?1:r[1]&&parseInt(r[1]),i=d(Number(u),Number(o));let m=1;"year-month"!==t&&"year"!==t&&(m=(Number(r[2])&&parseInt(String(r[2])))>i?i:r[2]&&parseInt(String(r[2])));let l=0,s=0;"datetime"===t&&(l=Number(r[3])&&parseInt(r[3]),s=Number(r[4])&&parseInt(r[4]));const c=new Date(Number(u),Number(o)-1,Number(m),l,s).getTime();return a=Y(c),a}();y("update:modelValue",t),y("change",{value:t,picker:$.$.exposed})}function I(){const{formatter:e,columnFormatter:t}=g;return t?t($.$.exposed):S().map((t=>t.values.map((a=>({label:e?e(t.type,h(a)):h(a),value:a})))))}function S(){const{filter:e}=g;return function(){if("time"===g.type)return[{type:"hour",range:[g.minHour,g.maxHour]},{type:"minute",range:[g.minMinute,g.maxMinute]}];const{maxYear:e,maxDate:t,maxMonth:a,maxHour:n,maxMinute:r}=T("max",w.value),{minYear:u,minDate:o,minMonth:i,minHour:m,minMinute:l}=T("min",w.value),s=[{type:"year",range:[u,e]},{type:"month",range:[i,a]},{type:"date",range:[o,t]},{type:"hour",range:[m,n]},{type:"minute",range:[l,r]}];"date"===g.type&&s.splice(3,2);"year-month"===g.type&&s.splice(2,3);"year"===g.type&&s.splice(1,4);return s}().map((({type:t,range:a})=>{let n=((e,t)=>{let a=-1;const n=Array(e<0?0:e);for(;++a<e;)n[a]=t(a);return n})(a[1]-a[0]+1,(e=>a[0]+e));return e&&(n=e(t,n)),{type:t,values:n}}))}function Y(e){const t="time"!==g.type;var a;if(t&&(!D(a=e)||Number.isNaN(a))?e=g.minDate:t||e||(e=`${h(g.minHour)}:00`),!t){let[t,a]=e.split(":");return t=h(v(Number(t),g.minHour,g.maxHour)),a=h(v(Number(a),g.minMinute,g.maxMinute)),`${t}:${a}`}return e=Math.min(Math.max(Number(e),g.minDate),g.maxDate)}function T(e,t){const a=new Date(t),n=new Date(g[`${e}Date`]),r=n.getFullYear();let u=1,o=1,i=0,m=0;return"max"===e&&(u=12,o=d(a.getFullYear(),a.getMonth()+1),i=23,m=59),a.getFullYear()===r&&(u=n.getMonth()+1,a.getMonth()+1===u&&(o=n.getDate(),a.getDate()===o&&(i=n.getHours(),a.getHours()===i&&(m=n.getMinutes())))),{[`${e}Year`]:r,[`${e}Month`]:u,[`${e}Date`]:o,[`${e}Hour`]:i,[`${e}Minute`]:m}}function P(e){const t=N(e,g.type);g.modelValue!==e&&(y("update:modelValue",e),y("change",{value:e,picker:$.$.exposed})),w.value=e,H.value=I(),F.value=t}function _(e){if("time"===g.type||"year-month"===g.type||"year"===g.type)return;const t=e.getValues(),a=Number(t[0]),n=Number(t[1]),r=d(a,n);let u=Number(t[2]);u=u>r?r:u;let o=0,i=0;"datetime"===g.type&&(o=Number(t[3]),i=Number(t[4]));const m=new Date(a,n-1,u,o,i).getTime();w.value=Y(m);const l=I(),s=e.getSelectedIndex().slice(0);l.forEach(((t,a)=>{const n=a+1,r=l[n];n>l.length-1||e.setColumnData(n,r,s[n]<=r.length-1?s[n]:0)}))}function j(){y("pickstart")}function E(){y("pickend")}return a((()=>g.modelValue),((e,t)=>{if(e===t)return;P(Y(e))}),{deep:!0,immediate:!0}),a((()=>g.type),(e=>{const t=["date","year-month","time","datetime","year"];-1===t.indexOf(e)&&console.error(`type must be one of ${t}`),k()}),{deep:!0,immediate:!0}),a((()=>g.filter),(e=>{e&&!x(e)&&console.error("The type of filter must be Function"),k()}),{deep:!0,immediate:!0}),a((()=>g.formatter),(e=>{e&&!x(e)&&console.error("The type of formatter must be Function"),k()}),{deep:!0,immediate:!0}),a((()=>g.columnFormatter),(e=>{e&&!x(e)&&console.error("The type of columnFormatter must be Function"),k()}),{deep:!0,immediate:!0}),a([()=>g.minDate,()=>g.maxDate,()=>g.minHour,()=>g.maxHour,()=>g.minMinute,()=>g.minMinute,()=>g.maxMinute],(()=>{k()}),{deep:!0,immediate:!0}),n((()=>{V.value=!0;P(Y(g.modelValue))})),(e,t)=>{const a=l;return r(),u(a,null,{default:o((()=>[i(s,{ref_key:"datePickerview",ref:M,"custom-class":e.customClass,"custom-style":e.customStyle,"immediate-change":e.immediateChange,modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=e=>F.value=e),columns:H.value,"columns-height":e.columnsHeight,columnChange:_,loading:e.loading,"loading-color":e.loadingColor,onChange:C,onPickstart:j,onPickend:E},null,8,["custom-class","custom-style","immediate-change","modelValue","columns","columns-height","loading","loading-color"])])),_:1})}}}),[["__scopeId","data-v-f292abf8"]]);export{N as g,w};
