import{d as s,X as e,v as a,o,c as r,w as t,x as p,p as n,n as l,y as i,i as m}from"./index-Fj9ozFXB.js";import{a5 as c,c as u,d as f,D as g,t as d,a6 as h,U as y,P as w,b as v}from"./page-wraper.D4oaE4iN.js";import{u as b}from"./useChildren.CNqwIpWf.js";const k=v(s({name:"wui-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:c,setup(s,{expose:c}){const{show:v}=u("wui-form-toast"),k=s,{children:x,linkChildren:C}=b(w);let j=e({});function _(s){s?j[s]="":Object.keys(j).forEach((s=>{j[s]=""}))}return C({props:k,errorMessages:j}),a((()=>k.model),(()=>{k.resetOnChange&&_()}),{immediate:!0,deep:!0}),c({validate:async function(s){const e=[];let a=!0;const o=[],r=function(){const s=y(k.rules);return x.forEach((e=>{d(e.prop)&&d(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)})),s}(),t=s?{[s]:r[s]}:r;for(const p in t){const s=t[p],r=g(k.model,p);if(s&&s.length>0)for(const t of s){if(t.required&&(!d(r)||""===r)){e.push({prop:p,message:t.message}),a=!1;break}if(t.pattern&&!t.pattern.test(r)){e.push({prop:p,message:t.message}),a=!1;break}const{validator:s,...n}=t;if(s){const l=s(r,n);h(l)?o.push(l.then((s=>{"string"==typeof s?(e.push({prop:p,message:s}),a=!1):"boolean"!=typeof s||s||(e.push({prop:p,message:t.message}),a=!1)})).catch((s=>{const o="string"==typeof s?s:s.message;e.push({prop:p,message:o||t.message}),a=!1}))):l||(e.push({prop:p,message:t.message}),a=!1)}}}return await Promise.all(o),function(s){const e=s.filter((s=>s.message));e.length&&("toast"===k.errorType?v(e[0].message):"message"===k.errorType&&e.forEach((s=>{j[s.prop]=s.message})))}(e),a&&(s?_(s):_()),{valid:a,errors:e}},reset:function(){_()}}),(s,e)=>{const a=m;return o(),r(a,{class:l(`wui-form ${s.customClass}`),style:i(s.customStyle)},{default:t((()=>[p(s.$slots,"default",{},void 0,!0),"toast"===k.errorType?(o(),r(f,{key:0,selector:"wui-form-toast"})):n("",!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-f8123a5a"]]);export{k as _};
